# SSH 通知工具需求文档

## 项目概述
开发一个通用的通知工具，支持本地和远程运行环境，为 CLI 工具提供多种通知方式（桌面弹窗、邮件、短信等）。

## 核心需求

### 1. 架构需求
- **CS 架构**：客户端-服务端分离
- **跨平台**：支持 Windows、macOS、Linux
- **双环境**：支持本地运行和远端 SSH 运行

### 2. 功能需求

#### 2.1 通知渠道
- **桌面通知**
  - Windows Toast 通知
  - macOS Notification Center
  - Linux notify-send
- **邮件通知**
  - SMTP 支持
  - HTML/文本格式
- **短信通知**
  - 支持 Twilio
  - 支持阿里云短信服务

#### 2.2 通知级别
- `info`: 信息通知（蓝色图标）
- `warning`: 警告通知（黄色图标）
- `error`: 错误通知（红色图标）

#### 2.3 消息内容
- 支持标题和正文
- 支持附件（图片等）
- 支持富文本格式

### 3. 网络需求

#### 3.1 本地运行
- Server 和 Client 在同一台机器
- 直接 localhost 通信
- 端口：默认 5000（可配置）

#### 3.2 远程运行
- **SSH 反向端口转发**（首选）
  ```bash
  ssh -R remote_port:localhost:local_port user@remote-host
  ```
- **SSH Proxy 命令**（备选）
- 支持 SSH 公私钥认证

### 4. 安全需求
- **认证机制**
  - API Token 认证
  - SSH 公私钥认证
- **网络安全**
  - 默认绑定 127.0.0.1
  - 不直接对外暴露
  - 通过 SSH 隧道安全传输

### 5. 配置需求
- 配置文件位置：`~/.notifytool/config.json`
- 支持环境变量覆盖
- 热加载配置（无需重启）

### 6. 性能需求
- **异步处理**：不阻塞 CLI 工具
- **队列机制**：处理大量并发通知
- **超时控制**：网络请求超时设置
- **重试机制**：失败重试策略

### 7. 可维护性需求
- **插件式架构**：通知渠道可扩展
- **日志系统**：记录通知历史和错误
- **监控指标**：成功率、延迟等
- **优雅关闭**：处理进程信号

## 技术栈选择

### 服务端
- **Runtime**: Node.js (LTS)
- **Web框架**: Express.js
- **桌面通知**: node-notifier
- **邮件发送**: nodemailer
- **短信发送**: twilio SDK / 阿里云 SDK
- **配置管理**: config / dotenv
- **日志**: winston
- **进程管理**: pm2 (可选)

### 客户端
- **HTTP客户端**: axios
- **CLI框架**: commander.js
- **配置解析**: yargs / minimist

## 部署需求
- **包管理**: npm/yarn
- **打包**: pkg (可选，生成可执行文件)
- **服务管理**: systemd / pm2
- **安装脚本**: 支持一键安装配置

## 质量需求
- **测试覆盖率**: >80%
- **文档完整性**: API 文档、使用说明
- **错误处理**: 完善的错误分类和处理
- **向后兼容**: API 版本管理